{% extends 'baseback.html.twig' %}

{% block body %}
	<div class="card">
		<div class="card-body">
			<h5 class="card-title"></h5>
			<div class="row">
				<div class="col">
					<input type="text" value="" class="form-control" placeholder="Rechercher Type_cat" id="searchTypeCategory">
				</div>
				<div class="col">
					<input type="text" value="" class="form-control" placeholder="Rechercher libelle" id="searchLibelle">
				</div>
				<div class="col">
					<input type="date" value="" class="form-control" placeholder="Rechercher dateplantation" id="searchDatePlantation">
				</div>
				<div class="col">
					<input type="date" value="" class="form-control" placeholder="Rechercher daterecolte" id="searchDateRecolte">
				</div>
				<div class="col">
					<input type="text" value="" class="form-control" placeholder="Rechercher revenues" id="searchRevenuesCultures">
				</div>
			</div>
		</div>

		<!-- Table with stripped rows -->
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Type_categorie</th>
					<th>libelle</th>
					<th>date de plantation</th>
					<th>date de recolte</th>
					<th>revenues de cultures</th>
					<th>couts de plantations</th>
					<th>actions</th>
				</tr>
			</thead>
			<tbody id="myTable">
				{% for culture in cultures %}
					<tr>
						<td>{{ culture.category.type }}</td>
						<td>{{ culture.libelle }}</td>
						<td>{{ culture.dateplantation ? culture.dateplantation|date('Y-m-d') : '' }}</td>
						<td>{{ culture.daterecolte ? culture.daterecolte|date('Y-m-d') : '' }}</td>
						<td>{{ culture.revenuescultures }}</td>
						<td>{{ culture.coutsplantations }}</td>
						<td>
							<a href="{{ path('app_cultureback_show', {'id': culture.id}) }}" class="btn btn-success rounded-pill py-2 px-4">
								<i class="fas fa-eye"></i>
							</a>
						</td>
					</tr>
				{% else %}
					<tr>
						<td colspan="7">no records found</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		<div style="width: 80%; margin: auto;">
			<canvas id="categorycultureChart" width="400" height="400"></canvas>
		</div>
	</div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
var ctx = document.getElementById('categorycultureChart').getContext('2d');
var data = {{ categorycultureCounts|json_encode|raw }};
console.log(data);
var labels = data.map(function (item) {
return item.type;
});

var culturename = data.map(function (item) {
return item.type;
});

var cultureCounts = data.map(function (item) {
return item.cultureCount;
});

var backgroundColors = generateRandomColors(data.length);

var chart = new Chart(ctx, {
type: 'pie',
data: {
labels: culturename,
datasets: [
{
data: cultureCounts,
backgroundColor: backgroundColors,
borderWidth: 1
}
]
},
options: {
responsive: true,
maintainAspectRatio: false
}
});

function generateRandomColors(count) {
var colors = [];
for (var i = 0; i < count; i++) {
colors.push(getRandomColor());
}
return colors;
}

function getRandomColor() {
var letters = '0123456789ABCDEF';
var color = '#';
for (var i = 0; i < 6; i++) {
color += letters[Math.floor(Math.random() * 16)];
}
return color;
}
});
</script>
<script>
	$(document).ready(function () { // Function to perform the search based on the specified column
function searchColumn(columnIndex, value) {
$("#myTable tr").filter(function () {
var cellText = $(this).find("td").eq(columnIndex).text().toLowerCase();
var found = cellText.indexOf(value) > -1;
$(this).toggle(found);
});
}

// Event handlers for each input element
$("#searchTypeCategory").on("keyup", function () {
searchColumn(0, $(this).val().toLowerCase());
});

$("#searchLibelle").on("keyup", function () {
searchColumn(1, $(this).val().toLowerCase());
});

$("#searchDatePlantation").on("change", function () {
searchColumn(2, $(this).val());
});

$("#searchDateRecolte").on("change", function () {
searchColumn(3, $(this).val());
});

$("#searchRevenuesCultures").on("keyup", function () {
searchColumn(4, $(this).val().toLowerCase());
});
});
</script>{% endblock %}