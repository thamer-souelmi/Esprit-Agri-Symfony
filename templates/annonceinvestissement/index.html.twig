{% extends 'inv.html.twig' %}

{% block body %}
    
    <!-- Flash Messages -->
    {% for flash_message in app.flashes('success') %}
        <div id="flash-success" class="alert alert-success">
            {{ flash_message }}
        </div>
    {% endfor %}
    
    <!-- Flash Error Messages -->
    {% for flash_message in app.flashes('error') %}
        <div id="flash-error" class="alert alert-danger">
            {{ flash_message }}
        </div>
    {% endfor %}
    
{% include 'annonceinvestissement/flash_messages.html.twig' %}

    {# Bouton #}
    <div class="d-flex justify-content-end">
    <div class="text-center">
        <a class="btn btn-secondary rounded-pill py-2 px-4" href="{{ path('app_annonceinvestissement_new') }}">Ajouter Annonce</a>
        <a class="btn btn-secondary rounded-pill py-2 px-4" href="{{ path('app_negociation_index') }}">Listes des Négociations</a>
    </div>
    </div>

    
    <!-- Banner Start -->
    <div class="container-xxl py-5">
        <div class="row gx-4">
            {% for annonceinvestissement in pagination %}
                <div class="col-md-6 col-lg-4 col-xl-3 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="product-item">
                        <div class="position-relative">
                            <!-- Your existing code for each announcement -->
                            <img class="img-fluid rounded" src="{{ asset('img/' ~ annonceinvestissement.photo) }}" style="width: 336px; height: 336px; object-fit: cover;">
                            <div class="product-overlay">
                                <a class="btn btn-square btn-secondary rounded-circle m-1"
                                    href="{{ path('app_annonceinvestissement_edit', {'idannonce': annonceinvestissement.idannonce}) }}">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form method="post" action="{{ path('app_annonceinvestissement_delete', {'idannonce': annonceinvestissement.idannonce}) }}" onsubmit="return confirm('Voulez vous vraiment supprimer cette annonce?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ annonceinvestissement.idannonce) }}">
                                    <button type="submit" class="btn btn-secondary rounded-circle m-1">
                                         <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                                <a class="btn btn-square btn-secondary rounded-circle m-1"
                                    href="{{ path('app_negociation_new', {'idannonce': annonceinvestissement.idannonce}) }}">
                                    <i class="bi bi-link"></i>
                                </a>
                                <a class="btn btn-square btn-secondary rounded-circle m-1"
                                    href="{{ path('app_negociation_show', {'idannonce': annonceinvestissement.idannonce }) }}">
                                    <i class="bi bi-eye"></i>
                                </a>
                                
                                <a class="btn btn-square btn-secondary rounded-circle m-1"
                                    href="{{ path('app_annonceinvestissement_show', {'idannonce': annonceinvestissement.idannonce }) }}">
                                    <i class="bi bi-upc-scan"></i>
                                </a>
                            </div>
                        </div>
                        
                            <div class="card-body">
                                <h5 class="card-title">{{ annonceinvestissement.titre }}</h5>
                                <p class="card-text">
                                    <strong style="color: #ffcc00;"><i class="fas fa-dollar-sign"></i>Montant:</strong>
                                    {{ annonceinvestissement.montant }}<br>
                                    <strong style="color: #ffcc00;"><i class="bi bi-calendar"></i>Date de
                                        publication:</strong>
                                    {{ annonceinvestissement.datepublication ? annonceinvestissement.datepublication|date('Y-m-d') : '' }}<br>
                                    <strong style="color: #ffcc00;"><i class="bi bi-file-text"></i>Description:</strong>
                                    {{ annonceinvestissement.description }}<br>
                                    <strong style="color: #ffcc00;"><i class="bi bi-geo-alt"></i>Localisation:</strong>
                                    {{ annonceinvestissement.localisation }}<br>
                                </p>
                            </div>
                        
                    </div>
                </div>
            {% else %}
                <p>No records found</p>
            {% endfor %}
        </div>
    </div>
    <!-- Banner End -->

    {# Pagination #}
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="text-center">
                {{ knp_pagination_render(pagination) }}
            </div>
        </div>
    </div>

    {# style of pagination #}
<style>
	.pagination {
		display: flex;
		justify-content: center;
		list-style: none;
		padding: 0;
	}

	.pagination li {
		margin: 0 5px;
	}

	.button-container {
		display: flex;
		flex-direction: row;
		overflow-x: auto;
		white-space: nowrap;
	}


	.button-container button {
		margin-right: 10px; /* Espacement entre les boutons */
	}

	.pagination a {
		text-decoration: none;
		padding: 5px 10px;
		border: 1px solid #404a3d; /* Bleu */
		border-radius: 3px;
		color: #404a3d; /* Bleu */
	}

	.pagination a:hover {
		background-color: #404a3d; /* Bleu au survol */
		color: #fff; /* Texte blanc au survol */
	}
</style>
    
    
    
    <!-- Inclusion de la bibliothèque QRCode.js -->
    <script type="text/javascript" src="{{ asset('js/qrcodejs-master/qrcode.min.js') }}"></script>

    <!-- Élément pour afficher le code QR -->
    <div id="mon_qr_code"></div>

    <!-- Script pour générer le code QR -->
    <script type="text/javascript">
        var qrcode;

        function generateQR(idannonce) {
            // Appel AJAX pour obtenir l'URL du code QR
            fetch("{{ path('app_annonceinvestissement_qrcode', {'idannonce': '__IDANNONCE__'}) }}".replace('__IDANNONCE__', idannonce))
                .then(response => response.json())
                .then(data => {
                    qrcode.clear();
                    qrcode.makeCode(data.qrCodeUrl);
                });
        }

        window.onload = function() {
            qrcode = new QRCode("mon_qr_code", {
                width: 128,
                height: 128
            });
        }
    function deleteAnnouncement(url, csrfToken) {
            if (confirm('Are you sure you want to delete this announcement?')) {
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: '_token=' + csrfToken,
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Handle success, e.g., display a success message
                    console.log(data.message);
                    window.location.reload(); // Reload the page or update the UI as needed
                })
                .catch(error => {
                    // Handle error, e.g., display an error message
                    console.error('There was a problem with the fetch operation:', error);
                });
            }
        }
        // Wait for the DOM to be ready
        document.addEventListener("DOMContentLoaded", function () {
            // Set a timeout to remove the success flash message after 10 seconds
            setTimeout(function () {
                var flashSuccessMessage = document.getElementById("flash-success");
                if (flashSuccessMessage) {
                    flashSuccessMessage.remove();
                }
            }, 10000);

            // Set a timeout to remove the error flash message after 10 seconds
            setTimeout(function () {
                var flashErrorMessage = document.getElementById("flash-error");
                if (flashErrorMessage) {
                    flashErrorMessage.remove();
                }
            }, 10000);
        });
    </script>
    <!-- Banner End -->
{% endblock %}
